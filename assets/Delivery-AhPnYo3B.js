import{c as B,b as Q,r as u,j as e,X as Y,v as D,p as ae,i as A,e as le,f as ne,g as F,I as H,B as ie,S as ce,P as oe,R as de,O as ue,h as xe,z as k,k as me}from"./index-CgAcR0s5.js";import{u as he,P as pe,C as ge}from"./useOrder-B0BR4Ezd.js";import{M as fe}from"./map-pin-BllIdwWQ.js";const be=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],W=B("chevron-right",be);const ye=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],je=B("credit-card",ye),N={name:"",lastName:"",address:"",city:"",state:"",zip:"",phone:""},Ne=()=>{try{const s=localStorage.getItem("currentUserId")||null;if(s){const a=JSON.parse(localStorage.getItem("users"))[s]||{},t={...N,name:a.name||"",lastName:a.lastName||""};return JSON.parse(localStorage.getItem(`delivery_${s}`))?.shippingData||t}return N}catch(s){return console.log(s.message),N}},P="SET_FIELD",q="RESET_FORM",X="GET_INFO_FROM_LS",M="INIT_SHIPPING",ve=(s,{type:a,payload:t})=>{switch(a){case P:return{...s,[t.field]:t.value};case q:return N;case X:return{...s,...t};case M:return t||N;default:return s}},we=({formData:s,dispatch:a,validation:t})=>{const{name:i,lastName:S,address:w,city:n,state:j,zip:d,phone:p}=s,{user:x}=Q(),g=u.useRef(!1),h=(l,m)=>{a({type:P,payload:{field:l,value:m}})},O=l=>{const m=l.replace(/\D/g,"");if(!m.length){a({type:P,payload:{field:"phone",value:""}});return}let v="",c=0;if(v+="+"+m[c],c+=1,m.length>c){const f=m.slice(c,c+3);v+="("+f+")",c+=f.length}if(m.length>c){const f=m.slice(c,c+3);v+=f,c+=f.length}if(m.length>c){const f=m.slice(c,c+4);v+="-"+f}a({type:P,payload:{field:"phone",value:v}})};return u.useEffect(()=>{g.current||!x?.name||!x?.lastName||(a({type:X,payload:{name:x.name,lastName:x.lastName}}),g.current=!0)},[a,x]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Shipping Address"}),e.jsx("p",{className:"text-gray-400",children:"Where should we deliver your order?"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"First Name"}),e.jsx("input",{value:i,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20
                            ${t.name||!i?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"John",onChange:l=>h("name",l.target.value)}),!t.name&&i&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsxs("span",{className:"inline-flex flex-col",children:["Only letters and spaces allowed.",e.jsx("span",{children:"Word must begin with a capital letter."})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Last Name"}),e.jsx("input",{value:S,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                            ${t.lastName||!S?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"Doe",onChange:l=>h("lastName",l.target.value)}),!t.lastName&&S&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsxs("span",{className:"inline-flex flex-col",children:["Only letters and spaces allowed.",e.jsx("span",{children:"Word must begin with a capital letter."})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Address"}),e.jsx("input",{value:w,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                        ${t.address||!w?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"Street address",onChange:l=>h("address",l.target.value)}),!t.address&&w&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"inline-flex flex-col",children:"At least 10 characters."})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"City"}),e.jsx("input",{value:n,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                            ${t.city||!n?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"City",onChange:l=>h("city",l.target.value)}),!t.city&&n&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"inline-flex flex-col",children:"Word must begin with a capital letter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"State / Region"}),e.jsx("input",{value:j,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                            ${t.state||!j?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"State",onChange:l=>h("state",l.target.value)}),!t.state&&j&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"inline-flex flex-col",children:"Word must begin with a capital letter"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"ZIP / Postal"}),e.jsx("input",{value:d,type:"text",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                            ${t.zip||!d?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"12345",onChange:l=>h("zip",l.target.value)}),!t.zip&&d&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"inline-flex flex-col",children:"Max. 5 digits."})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:p,type:"tel",className:`w-full rounded-xl border border-white/10 bg-white/5 px-4 py-3 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-violet-500/20  
                            ${t.phone||!p?"border-neutral-700 focus:border-violet-500/50":"border-red-500/50 focus:border-red-500"}`,placeholder:"+7 (920) 000-00-00",onChange:l=>O(l.target.value)}),p&&e.jsx("button",{onClick:()=>h("phone",""),className:"absolute top-1/2 right-[0.5rem] -translate-1/2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(Y,{className:"w-5 h-5 text-gray-400 hover:text-white"})})]}),!t.phone&&p&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center gap-1 animate-fadeIn",children:[e.jsx("span",{className:"inline-block w-1 h-1 rounded-full bg-red-400"}),e.jsx("span",{className:"inline-flex flex-col",children:'Only digits and "+", "(", ")" signs allowed. Total 12 characters.'})]})]})]})},Ie=({tariffs:s,selectedDeliveryTariff:a,selectDeliveryTariff:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Delivery Method"}),e.jsx("p",{className:"text-gray-400",children:"Choose your preferred shipping speed"})]}),e.jsx("div",{className:"space-y-3",children:Object.values(s).map(i=>e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-4 p-4 rounded-2xl border border-white/10 bg-white/5 hover:border-violet-500/50 cursor-pointer transition-colors",children:[e.jsx("input",{type:"radio",name:"delivery",checked:a===i.name,className:"h-5 w-5 accent-violet-500",onChange:()=>{t(i.name)}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-semibold",children:i.name}),e.jsxs("span",{className:"font-semibold inline-flex text-white justify-center items-center gap-1",children:[e.jsx("span",{className:"text-lg",children:i.price}),e.jsx("img",{src:D,alt:"Value Icon",className:"text-lg w-3.5 h-3.5"})]})]}),e.jsx("p",{className:"text-sm text-gray-400",children:i.desc}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.time})]})]})},i.name))})]}),T=[{id:1,title:"Shipping",icon:fe},{id:2,title:"Delivery",icon:pe},{id:3,title:"Payment",icon:je},{id:4,title:"Confirm",icon:ge}],Se=()=>{try{const s=localStorage.getItem("currentUserId")||null;return s&&JSON.parse(localStorage.getItem(`delivery_${s}`))?.currentStep||1}catch(s){return console.log(s.message),1}},Oe=()=>{try{const s=localStorage.getItem("currentUserId")||null;return s&&JSON.parse(localStorage.getItem(`delivery_${s}`))?.pendingOrderId||null}catch(s){return console.log(s.message),null}};function ke(){const s=u.useRef(null),a=u.useRef(Oe()),[t,i]=u.useState(Se),[S,w]=u.useState(!1),[n,j]=u.useReducer(ve,N,Ne),[d,p]=u.useReducer(ae,A,le),{cart:x,totalValue:g,totalCount:h,selectedDeliveryTariff:O,removeItem:l,incQty:m,decQty:v,selectDeliveryTariff:c,resetCart:f}=ne(),{initOrders:z,createOrder:V,updateOrderStatus:K,startDeliveryTimer:ee,cancelOrder:J}=he(),{currentUserId:o}=Q(),C=parseFloat((g*.05).toFixed(2)),U=xe<=g,I=U?0:F[O??"Eco"].price,Z={name:/^[A-ZА-ЯЁ][a-zа-яё]+$/.test(n.name),lastName:/^[A-ZА-ЯЁ][a-zа-яё]+$/.test(n.lastName),address:n.address.length>=10,city:/^[A-ZА-ЯЁ][a-zа-яё]+(?:[\s-][A-ZА-ЯЁ][a-zа-яё]+)*$/.test(n.city),state:/^[A-ZА-ЯЁ][a-zа-яё]+(?:[\s-][A-ZА-ЯЁ][a-zа-яё]+)*$/.test(n.state),zip:/^\d{5}(-\d{4})?$/.test(n.zip),phone:/^\+[1-9]\(\d{3}\)\d{3}-\d{4}$/.test(n.phone)},E=Object.values(Z).every(r=>r===!0),L={cardNumber:/^\d{4} \d{4} \d{4} \d{4}$/.test(d.cardNumber),expiryDate:/^(0[1-9]|1[0-2])\/\d{2}$/.test(d.expiryDate),cvv:/^\d{3}$/.test(d.cvv),cardHolder:/^[A-ZА-ЯЁ][a-zа-яё]+ [A-ZА-ЯЁ][a-zа-яё]+$/.test(d.cardHolder)},G=Object.values(L).every(r=>r===!0),te=r=>r<=t?!0:!(r===2&&!E||r===3&&!E||r===4&&(!E||!G)),R=r=>{if(!te(r)){k.error("Please fill in fields correctly!");return}if(Object.values(x).length===0){k.error("Please add items to cart!");return}i(r),k.success("Success!")},re=()=>{j({type:q}),p({type:me}),f()},se=async()=>{w(!0),s.current?.abort(),s.current=new AbortController;const r=s.current.signal;try{await k.promise(new Promise((b,y)=>{const _=setTimeout(()=>{b(!0)},2e3);if(r){if(r.aborted){clearTimeout(_),y(new DOMException("Aborted","AbortError"));return}r.addEventListener("abort",()=>{clearTimeout(_),y(new DOMException("Aborted","AbortError"))},{once:!0})}}),{loading:"Placing your order...",success:"Order placed successfully!"}),K(a.current,"shipped"),ee(a.current),localStorage.removeItem(`delivery_${o}`),re(),i(1),a.current=null}catch(b){b.name==="AbortError"?k.success("Order cancelled"):console.log(b.message)}finally{w(!1),s.current=null}},$=u.useCallback(()=>{s.current?.abort(),s.current=null},[]);return u.useEffect(()=>{if(t!==3&&t!==4||a.current)return;const r=V({date:new Date().toString().split(" GMT")[0],cartItems:x,totalValue:g+C+I,taxValue:C,deliveryValue:I,totalCount:h,status:"processing"});a.current=r,localStorage.setItem(`delivery_${o}`,JSON.stringify({shippingData:n,paymentInfoData:d,currentStep:t,pendingOrderId:r}))},[g,C,I,h,x,V,t,o,n,d]),u.useEffect(()=>{if(o){const r=JSON.parse(localStorage.getItem(`delivery_${o}`))||{},b=JSON.parse(localStorage.getItem(`orders_${o}`))||{orders:{}};j({type:M,payload:r?.shippingData||N}),p({type:H,payload:r?.paymentInfoData||A}),i(r?.currentStep||1),z(b.orders||{});const y=r?.pendingOrderId;y&&b.orders?.[y]?.status==="processing"?a.current=y:a.current=null}else j({type:M,payload:N}),p({type:H,payload:A}),i(1),z({}),a.current=null},[o,z]),u.useEffect(()=>{o&&localStorage.setItem(`delivery_${o}`,JSON.stringify({shippingData:n,paymentInfoData:d,currentStep:t,pendingOrderId:a.current}))},[t,o,n,d]),u.useEffect(()=>{if(t<=2&&a.current){$(),J(a.current);const r=JSON.parse(localStorage.getItem(`delivery_${o}`))||{},b=JSON.parse(localStorage.getItem(`orders_${o}`))||{orders:{}},y={...r},_={...b};delete y.pendingOrderId,delete _.orders[a.current],localStorage.setItem(`delivery_${o}`,JSON.stringify(y)),localStorage.setItem(`orders_${o}`,JSON.stringify(_)),a.current=null}},[t,$,J,o]),u.useEffect(()=>()=>$(),[$]),e.jsx("section",{className:"container w-full text-white sm:px-6",children:e.jsxs("div",{className:"flex flex-col mt-[2rem]",children:[e.jsx(ie,{}),e.jsxs("div",{className:"container w-full py-8",children:[e.jsx("div",{className:"max-w-4xl mx-auto mb-12",children:e.jsxs("div",{className:"flex items-center justify-between relative",children:[e.jsx("div",{className:"absolute left-0 right-0 top-1/2 h-0.5 -translate-y-1/2 bg-gradient-to-r from-white/10 via-white/10 to-white/10"}),e.jsx("div",{className:"absolute left-0 top-1/2 h-0.5 -translate-y-1/2 bg-gradient-to-r from-violet-500 via-purple-500 to-fuchsia-500 transition-all duration-500",style:{width:`${(t-1)/(T.length-1)*100}%`}}),T.map(r=>e.jsx(ce,{step:r,currentStep:t,handleContinueButton:R},r.id))]})}),e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1fr_400px]",children:[e.jsxs("div",{className:"rounded-3xl border border-white/10 bg-gradient-to-br from-zinc-900/80 via-purple-900/10 to-zinc-900/80 p-8 backdrop-blur",children:[t===1&&e.jsx(we,{formData:n,dispatch:j,validation:Z}),t===2&&e.jsx(Ie,{tariffs:F,selectedDeliveryTariff:O,selectDeliveryTariff:c}),t===3&&e.jsx(oe,{formData:d,dispatch:p,validation:L}),t===4&&e.jsx(de,{allDeliveryInfo:{shippingData:n,paymentInfoData:d,tariff:F[O]}}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-white/10",children:[e.jsx("button",{onClick:()=>R(Math.max(1,t-1)),disabled:t===1,className:"px-6 cursor-pointer py-3 rounded-xl border border-white/10 bg-white/5 text-white disabled:opacity-30 disabled:cursor-not-allowed hover:bg-white/10 transition-colors",children:"Back"}),t!==T.length?e.jsxs("button",{className:`px-6 inline-flex justify-center items-center gap-2 cursor-pointer py-3 rounded-xl border border-white/10 bg-white/5 text-white hover:bg-white/10 transition-colors disabled:opacity-30 disabled:cursor-not-allowed
                                                ${t===1&&!E||t===3&&!G?"opacity-50 not-allowed":""}
                                            `,onClick:()=>R(Math.min(T.length,t+1)),children:["Continue",e.jsx(W,{className:"h-4 w-4"})]}):S?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"px-6 inline-flex justify-center items-center gap-2 cursor-pointer py-3 rounded-xl border border-white/10 bg-white/5 text-white hover:bg-white/10 transition-colors",children:[e.jsx("div",{className:"opacity-50 w-5 h-5 border-4 border-white/30 border-t-white rounded-full animate-spin"}),"Placing..."]}),e.jsx("button",{className:"px-6 inline-flex justify-center items-center gap-2 cursor-pointer py-3 rounded-xl border border-white/10 bg-white/5 text-white hover:bg-white/10 transition-colors",onClick:$,children:e.jsx(Y,{})})]})}):e.jsxs("button",{className:"px-6 inline-flex justify-center items-center gap-2 cursor-pointer py-3 rounded-xl border border-white/10 bg-white/5 text-white hover:bg-white/10 transition-colors",onClick:se,children:["Place Order",e.jsx(W,{className:"h-4 w-4"})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-white/10 bg-gradient-to-br from-zinc-900/60 via-purple-900/20 to-zinc-900/60 p-6 backdrop-blur h-fit sticky top-24",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"max-h-[25rem] overflow-y-auto scrollbar-reviews custom-scroll",children:[Object.values(x).map(r=>e.jsx(ue,{item:r,removeItem:l,incQty:m,decQty:v,currentStep:t},r.id)),Object.values(x).length===0&&e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Your cart is empty."})]}),e.jsxs("div",{className:"space-y-2 py-4 border-t border-b border-white/10",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Subtotal"}),e.jsxs("span",{className:"inline-flex text-white justify-center items-center gap-1",children:[g,e.jsx("img",{src:D,alt:"Value Icon",className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Shipping"}),e.jsxs("span",{className:"inline-flex text-white justify-center items-center gap-1",children:[I?`at least ${I}`:"Free",e.jsx("img",{src:D,alt:"Value Icon",className:"w-4 h-4"})]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"Tax"}),e.jsxs("span",{className:"inline-flex justify-center items-center gap-1 text-white",children:[C,e.jsx("img",{src:D,alt:"Value Icon",className:"w-4 h-4"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx("span",{className:"text-2xl font-semibold",children:"Total"}),e.jsxs("span",{className:"text-2xl font-semibold inline-flex text-white justify-center items-center gap-1",children:[Object.values(x).length===0?0:g+C+(U?0:I),e.jsx("img",{src:D,alt:"Value Icon",className:"w-6 h-6"})]})]})]})]})})]})]})})}export{ke as default};
